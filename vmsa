Update Default SSL Certificates with New Entrust SSL Certificates:

Please remember that file names & commands entered in the SSH session are case-sensitive.  Please take care to enter them as shown in these in these instructions.

•	Once you have received the new Entrust certificates, save them to the same folder on the Jump share that contains the .csr & .key files - \vCenter\vCenter 6.0.X\VCSA PSC SSL Certs\INTERNAL\<PSC or VCSA server name>\.  The cert file names should match the csr, except for the .cer extension.

•	Open an RDP session to the PSC or VCSA
o	SSH to the PSC or VCSA
o	login as root
o	run shell.set --enable True<Enter>
o	type shell<Enter>
o	type chsh -s /bin/bash root<Enter>
o	Leave SSH window open

•	Run WinSCP & connect to the PSC or VCSA using the root ID
•	From WinSCP, copy all new Entrust .cer files from Jump share
\vCenter\vCenter 6.0.X\VCSA PSC SSL Certs\INTERNAL\ to /usr/lib/vmware-vmca/bin/ on PSC or VCSA
•	Close WinSCP
•	From SSH session, change directory to /usr/lib/vmware-vmca/bin/
•	Type ls -l<Enter> to list contents of directory
•	Verify that you see these files for a PSC:
o	root64.cer
o	ciapscmpNNNN-machine.cer
o	ciapscmpNNNN-machine.key
o	ciapscmpNNNN-machine_ssl.cer
o	ciapscmpNNNN-machine_ssl.key
o	ciapscmpNNNN-vsphere-webclient.cer
o	ciapscmpNNNN-vsphere-webclient.key

•	Or these files for a VCSA:
o	root64.cer
o	ciavcsmpNNNN-machine.cer
o	ciavcsmpNNNN-machine.key
o	ciavcsmpNNNN-machine_ssl.cer
o	ciavcsmpNNNN-machine_ssl.key
o	ciavcsmpNNNN-vsphere-webclient.cer
o	ciavcsmpNNNN-vsphere-webclient.key
o	ciavcsmpNNNN-vpxd.cer
o	ciavcsmpNNNN-vpxd.key
o	ciavcsmpNNNN-vpxd-extension.cer
o	ciavcsmpNNNN-vpxd-extension.key

•	Type ./certificate-manager<Enter>
•	Type 1<Enter> to Replace Machine SSL certificate with Custom Certificate
•	At username: prompt, type Administrator@vsphere-srv.local (or Administrator@vsphere-vdi.local for VDI SSO Domain) & hit <Enter>
•	Type password & hit <Enter>
•	If updating a VCSA, you will see this prompt Performing operation on distributed setup, Please provide valid Infrastructure Server IP - Enter IP address for the VCSA that you are updating & hit <Enter>
•	Type 2<Enter> to Import custom certificate(s) and key(s) to replace existing Machine SSL certificate
•	At prompt for Please provide valid custom certificate for Machine SSL, type the corresponding PSC or VCSA machine_ssl.cer file name, i.e. ./ciapscmpNNNN-machine_ssl.cer & hit <Enter>
•	At prompt for Please provide valid custom key for Machine SSL, type the corresponding PSC or VCSA machine_ssl.key file name, i.e.  ./ciapscmpNNNN-machine_ssl.key & hit <Enter>
•	At prompt for Please provide the signing certificate of the Machine SSL certificate, type ./root64.cer<Enter>
•	At prompt for You are going to replace Machine SSL cert using custom cert Continue operation : Option[Y/N] type y<Enter>
•	Wait for Status : 100% Completed [All tasks completed successfully]

•	You can ignore message to restart services for now
•	Run certificate-manager again to replace Solution User certificates- type ./certificate-manager<Enter>
•	Type 5<Enter> to Replace Solution user certificates with Custom Certificate
•	At username: prompt, type Administrator@vsphere-srv.local (or Administrator@vsphere-vdi.local for VDI SSO Domain) & hit <Enter>
•	Type password & hit <Enter>
•	If updating a VCSA, you will see this prompt Performing operation on distributed setup, Please provide valid Infrastructure Server IP - Enter IP address for the VCSA that you are updating & hit <Enter>
•	Type 2<Enter> for Import custom certificate(s) and key(s) to replace existing Solution User Certificates
•	Based on whether you are upgrading a PSC or a VCSA you will be prompted for different .cer & .key files.  Enter the following when prompted:
•	For PSC:
o	./ciapscmpNNNN-machine.cer
o	./ciapscmpNNNN-machine.key
o	./ciapscmpNNNN-vsphere-webclient.cer
o	./ciapscmpNNNN-vsphere-webclient.key
o	./root64.cer

•	For VCSA:
o	./ciavcsmpNNNN-machine.cer
o	./ciavcsmpNNNN-machine.key
o	./ciavcsmpNNNN-vsphere-webclient.cer
o	./ciavcsmpNNNN-vsphere-webclient.key
o	./ciavcsmpNNNN-vpxd.cer
o	./ciavcsmpNNNN-vpxd.key
o	./ciavcsmpNNNN-vpxd-extension.cer
o	./ciavcsmpNNNN-vpxd-extension.key
o	./root64.cer

•	At prompt for You are going to replace Machine SSL cert using custom cert Continue operation : Option[Y/N] type y<Enter>
•	Wait for Status : 100% Completed [All tasks completed successfully]
•	You can ignore message to restart services for now
•	To update the VAMI SSL certificate, type:
cd /usr/lib/applmgmt/support/scripts/postinstallscripts/<Enter>
•	Type ./lighttpd-vecs-integration.sh<Enter>
•	Change back to appliance shell by typing 
chsh -s /bin/appliancesh root<Enter>
•	Exit out of SSH session
•	Update Machine & Solution User certs for all remaining PSC’s before updating SSL certs for VCSA’s.
•	When all PSC’s & VCSA’s in the same SSO Domain have been updated, restart all PSC’s, then restart all the VCSA’s.
•	After verifying you can log into all vCenters, log into the VAMI(https://<FQDN PSC or VCSA:5480) for each PSC & VCSA using root ID & disable BASH Shell & SSH.
•	Unmount Install ISO from Jump Server/s.
